<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multiplayer Tic-Tac-Toe</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #333;
    }
    .container {
      background: white;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      padding: 30px;
      text-align: center;
      max-width: 500px;
      width: 100%;
    }
    h1 {
      margin-bottom: 30px;
      color: #4a5568;
    }
    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      background: #e53e3e;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
    }
    .back-btn:hover {
      background: #c53030;
    }
    .room-input {
      margin: 20px 0;
    }
    input {
      padding: 8px;
      border: 1px solid #cbd5e0;
      border-radius: 4px;
      margin-right: 10px;
    }
    button {
      background: #4299e1;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 0 10px;
      transition: background 0.3s;
    }
    button:hover {
      background: #3182ce;
    }
    .game-board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 20px 0;
      max-width: 300px;
      margin: 0 auto;
    }
    .cell {
      width: 80px;
      height: 80px;
      background: #e2e8f0;
      border: none;
      border-radius: 5px;
      font-size: 36px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background 0.3s;
    }
    .cell:hover {
      background: #cbd5e0;
    }
    .cell.x {
      color: #4299e1;
    }
    .cell.o {
      color: #e53e3e;
    }
    .status {
      margin: 20px 0;
      font-size: 18px;
      font-weight: bold;
    }
    .hidden {
      display: none;
    }
    .winner-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .popup-content {
      background: white;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
    }
  </style>
</head>
<body>
  <a href="index.html" class="back-btn">‚Üê Back to Menu</a>
  <div class="container">
    <h1>Multiplayer Tic-Tac-Toe</h1>

    <div id="room-setup" class="room-input">
      <input type="text" id="room-id" placeholder="Enter Room ID">
      <button id="join-btn">Join Game</button>
    </div>

    <div id="game-area" class="hidden">
      <div class="status" id="status">Waiting for players...</div>
      <div class="game-board" id="board">
        <div class="cell" data-index="0"></div>
        <div class="cell" data-index="1"></div>
        <div class="cell" data-index="2"></div>
        <div class="cell" data-index="3"></div>
        <div class="cell" data-index="4"></div>
        <div class="cell" data-index="5"></div>
        <div class="cell" data-index="6"></div>
        <div class="cell" data-index="7"></div>
        <div class="cell" data-index="8"></div>
      </div>
      <button id="reset-btn" class="hidden">Reset Game</button>
    </div>

    <div id="winner-popup" class="winner-popup hidden">
      <div class="popup-content">
        <h2 id="winner-message"></h2>
        <button id="play-again-btn">Play Again</button>
        <button id="back-to-menu-btn">Back to Menu</button>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let currentPlayer = 'X';
    let gameActive = false;

    document.getElementById('join-btn').addEventListener('click', () => {
      const roomId = document.getElementById('room-id').value.trim();
      if (roomId) {
        socket.emit('joinGame', roomId);
        document.getElementById('room-setup').classList.add('hidden');
        document.getElementById('game-area').classList.remove('hidden');
      }
    });

    document.getElementById('reset-btn').addEventListener('click', () => {
      socket.emit('resetGame', document.getElementById('room-id').value);
    });

    document.getElementById('play-again-btn').addEventListener('click', () => {
      document.getElementById('winner-popup').classList.add('hidden');
      document.getElementById('reset-btn').click();
    });

    document.getElementById('back-to-menu-btn').addEventListener('click', () => {
      window.location.href = 'index.html';
    });

    // Socket.IO event listeners
    socket.on('playerJoined', (data) => {
      document.getElementById('status').textContent = `Players: ${data.playerCount}/2`;
      updateBoard(data.gameState.board);
    });

    socket.on('gameStart', (data) => {
      gameActive = true;
      document.getElementById('status').textContent = `Game started! You are ${data.players.find(p => p.id === socket.id).symbol}`;
      document.getElementById('reset-btn').classList.remove('hidden');
    });

    socket.on('moveMade', (data) => {
      updateBoard(data.gameState.board);
      document.getElementById('status').textContent = `Current turn: ${data.gameState.currentPlayer}`;
    });

    socket.on('gameEnd', (data) => {
      gameActive = false;
      let message = data.isDraw ? "It's a draw!" : `${data.winner} wins!`;
      showWinnerPopup(message);
    });

    socket.on('gameReset', (data) => {
      gameActive = true;
      updateBoard(data.board);
      document.getElementById('status').textContent = `Game reset! Current turn: ${data.currentPlayer}`;
    });

    socket.on('playerDisconnected', (data) => {
      document.getElementById('status').textContent = `Player disconnected. Waiting for reconnection...`;
      gameActive = false;
    });

    socket.on('spectatorJoined', (data) => {
      document.getElementById('status').textContent = 'Spectating game...';
      updateBoard(data.board);
    });

    function updateBoard(board) {
      const cells = document.querySelectorAll('.cell');
      cells.forEach((cell, index) => {
        cell.textContent = board[index] || '';
        cell.classList.remove('x', 'o');
        if (board[index] === 'X') cell.classList.add('x');
        if (board[index] === 'O') cell.classList.add('o');
      });
    }

    function showWinnerPopup(message) {
      document.getElementById('winner-message').textContent = message;
      document.getElementById('winner-popup').classList.remove('hidden');
    }
  </script>
</body>
</html>
