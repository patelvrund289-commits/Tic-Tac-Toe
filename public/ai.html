<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Tic-Tac-Toe</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #333;
    }
    .container {
      background: white;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      padding: 30px;
      text-align: center;
      max-width: 500px;
      width: 100%;
    }
    h1 {
      margin-bottom: 30px;
      color: #4a5568;
    }
    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      background: #e53e3e;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
    }
    .back-btn:hover {
      background: #c53030;
    }
    button {
      background: #4299e1;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 0 10px;
      transition: background 0.3s;
    }
    button:hover {
      background: #3182ce;
    }
    .game-board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 20px 0;
      max-width: 300px;
      margin: 0 auto;
    }
    .cell {
      width: 80px;
      height: 80px;
      background: #e2e8f0;
      border: none;
      border-radius: 5px;
      font-size: 36px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background 0.3s;
    }
    .cell:hover {
      background: #cbd5e0;
    }
    .cell.x {
      color: #4299e1;
    }
    .cell.o {
      color: #e53e3e;
    }
    .status {
      margin: 20px 0;
      font-size: 18px;
      font-weight: bold;
    }
    .hidden {
      display: none;
    }
    .winner-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .popup-content {
      background: white;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
    }
  </style>
</head>
<body>
  <a href="index.html" class="back-btn">‚Üê Back to Menu</a>
  <div class="container">
    <h1>Play vs AI</h1>

    <div id="game-area">
      <div class="status" id="status">Your turn (X)</div>
      <div class="game-board" id="board">
        <div class="cell" data-index="0"></div>
        <div class="cell" data-index="1"></div>
        <div class="cell" data-index="2"></div>
        <div class="cell" data-index="3"></div>
        <div class="cell" data-index="4"></div>
        <div class="cell" data-index="5"></div>
        <div class="cell" data-index="6"></div>
        <div class="cell" data-index="7"></div>
        <div class="cell" data-index="8"></div>
      </div>
      <button id="reset-btn">Reset Game</button>
    </div>

    <div id="winner-popup" class="winner-popup hidden">
      <div class="popup-content">
        <h2 id="winner-message"></h2>
        <button id="play-again-btn">Play Again</button>
        <button id="back-to-menu-btn">Back to Menu</button>
      </div>
    </div>
  </div>

  <script>
    let aiGame = null;

    // Initialize game
    startAIGame();

    document.getElementById('reset-btn').addEventListener('click', () => {
      resetAIGame();
    });

    document.getElementById('play-again-btn').addEventListener('click', () => {
      document.getElementById('winner-popup').classList.add('hidden');
      resetAIGame();
    });

    document.getElementById('back-to-menu-btn').addEventListener('click', () => {
      window.location.href = 'index.html';
    });

    // Game board interaction
    document.getElementById('board').addEventListener('click', (e) => {
      if (!aiGame || aiGame.winner || aiGame.isDraw) return;
      const cell = e.target;
      if (!cell.classList.contains('cell') || cell.textContent) return;

      const index = parseInt(cell.dataset.index);
      makeAIMove(index);
    });

    function startAIGame() {
      aiGame = new TicTacToe();
      updateBoard(aiGame.board);
      document.getElementById('status').textContent = 'Your turn (X)';
    }

    function makeAIMove(index) {
      if (!aiGame.makeMove(index)) return;

      updateBoard(aiGame.board);
      if (aiGame.winner || aiGame.isDraw) {
        let message = aiGame.isDraw ? "It's a draw!" : `${aiGame.winner} wins!`;
        showWinnerPopup(message);
        return;
      }

      // AI move
      setTimeout(() => {
        const aiMove = aiGame.getBestMove();
        aiGame.makeMove(aiMove);
        updateBoard(aiGame.board);
        if (aiGame.winner || aiGame.isDraw) {
          let message = aiGame.isDraw ? "It's a draw!" : `${aiGame.winner} wins!`;
          showWinnerPopup(message);
        } else {
          document.getElementById('status').textContent = 'Your turn (X)';
        }
      }, 500);
    }

    function resetAIGame() {
      aiGame.reset();
      updateBoard(aiGame.board);
      document.getElementById('status').textContent = 'Your turn (X)';
    }

    function updateBoard(board) {
      const cells = document.querySelectorAll('.cell');
      cells.forEach((cell, index) => {
        cell.textContent = board[index] || '';
        cell.classList.remove('x', 'o');
        if (board[index] === 'X') cell.classList.add('x');
        if (board[index] === 'O') cell.classList.add('o');
      });
    }

    function showWinnerPopup(message) {
      document.getElementById('winner-message').textContent = message;
      document.getElementById('winner-popup').classList.remove('hidden');
    }

    // TicTacToe class for AI
    class TicTacToe {
      constructor() {
        this.board = Array(9).fill(null);
        this.currentPlayer = 'X';
        this.winner = null;
        this.isDraw = false;
      }

      makeMove(index) {
        if (this.board[index] || this.winner) return false;
        this.board[index] = this.currentPlayer;
        this.checkWinner();
        this.currentPlayer = this.currentPlayer === 'X' ? 'O' : 'X';
        return true;
      }

      checkWinner() {
        const winPatterns = [
          [0,1,2], [3,4,5], [6,7,8],
          [0,3,6], [1,4,7], [2,5,8],
          [0,4,8], [2,4,6]
        ];

        for (let pattern of winPatterns) {
          const [a, b, c] = pattern;
          if (this.board[a] && this.board[a] === this.board[b] && this.board[a] === this.board[c]) {
            this.winner = this.board[a];
            return;
          }
        }

        if (this.board.every(cell => cell)) {
          this.isDraw = true;
        }
      }

      getBestMove() {
        let bestScore = -Infinity;
        let bestMove = -1;

        for (let i = 0; i < 9; i++) {
          if (!this.board[i]) {
            this.board[i] = 'O';
            let score = this.minimax(this.board, 0, false);
            this.board[i] = null;
            if (score > bestScore) {
              bestScore = score;
              bestMove = i;
            }
          }
        }

        return bestMove;
      }

      minimax(board, depth, isMaximizing) {
        const result = this.checkGameState(board);
        if (result !== null) {
          return result;
        }

        if (isMaximizing) {
          let bestScore = -Infinity;
          for (let i = 0; i < 9; i++) {
            if (!board[i]) {
              board[i] = 'O';
              let score = this.minimax(board, depth + 1, false);
              board[i] = null;
              bestScore = Math.max(score, bestScore);
            }
          }
          return bestScore;
        } else {
          let bestScore = Infinity;
          for (let i = 0; i < 9; i++) {
            if (!board[i]) {
              board[i] = 'X';
              let score = this.minimax(board, depth + 1, true);
              board[i] = null;
              bestScore = Math.min(score, bestScore);
            }
          }
          return bestScore;
        }
      }

      checkGameState(board) {
        const winPatterns = [
          [0,1,2], [3,4,5], [6,7,8],
          [0,3,6], [1,4,7], [2,5,8],
          [0,4,8], [2,4,6]
        ];

        for (let pattern of winPatterns) {
          const [a, b, c] = pattern;
          if (board[a] && board[a] === board[b] && board[a] === board[c]) {
            return board[a] === 'O' ? 10 - depth : depth - 10;
          }
        }

        if (board.every(cell => cell)) {
          return 0;
        }

        return null;
      }

      reset() {
        this.board = Array(9).fill(null);
        this.currentPlayer = 'X';
        this.winner = null;
        this.isDraw = false;
      }
    }
  </script>
</body>
</html>
